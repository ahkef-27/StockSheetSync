## 📈 株価管理ツール（Google スプレッドシート × Apps Script）

Google Apps Script と Google スプレッドシートを活用した、米国株価の自動取得・可視化ツールです。 ユーザーの手を煩わせることなく、リアルタイム株価の取得・変動率の色分け・日別＆週別のグラフ生成を自動で行います。

---

## システム概要

この株価管理ツールは、Google スプレッドシートとApps Scriptを活用して、米国株価の取得・可視化・記録を完全自動化するツールです。

毎日の株価チェックや記録作業を自動化し、視覚的にわかりやすいグラフで変動を把握できるように設計しました。 投資初心者から日々の株価管理を効率化したい方まで、誰でも簡単に使えることを目指しています。

---

## 🛠 主な機能

✅ 米国市場の取引時間に合わせて、22時台〜5時台の株価を自動取得するように設計されています。

✅ AAPL / META / GOOGL の株価を定期取得（※主要テック銘柄を例として設定）

✅ 5%、10%の変動に応じたセルの色分け

✅ 取得失敗時のエラーハンドリング（グレー表示）

✅ 日別の株価推移グラフを自動生成

✅ 過去7日間の株価をまとめた週次グラフも自動生成

✅ 日付が変わると「本日株価」シートをリセットして新規記録

✅ 全シートに日付を自動挿入

✅ 視認性を高めるスタイル統一（フォントサイズ・行高・中央揃え）

---

## 🧭システムの流れ

このツールを使うと、Google スプレッドシート上で株価データが自動的に蓄積・可視化されます。

Apple、Meta、Googleの株価が時間ごとに記録され、右側にはそれぞれの銘柄の株価推移が折れ線グラフとして表示されます。

1日分の動きがひと目で把握できるようになっており、基本的には以下のような画面になります：

![本日株価シート](Images/Sheet01.png)

### 🗂 本日株価シート

このツールは、まず1点から始まります。時間ごとの株価を記録し、1日分の動きを一覧で確認できます。

初回実行時は1データのみですが、以降自動で下に蓄積されていきます

![日グラフの例](Images/Sheet02.png)


### 📈 日別グラフ

取得された株価をもとに、リアルタイムでグラフが生成されます。

数時間でここまでデータが蓄積され、グラフも動き出します。

Metaの急落やGoogleの微増など、変動が視覚化されます。

![週次の例](Images/Sheet03.png)


### 📊 週次グラフ（データ一覧）

各日の終値をまとめて表示

日々の変動を確認でき、投資判断や報告資料にも活用可能です 

この例では、Metaの終値が10%以上下落しているため、C5セルが赤く表示され、変動の大きさが一目でわかります。

![週次グラフの例](Images/Sheet04.png)

---

## 🚀 使い方

Google スプレッドシートを作成

Apps Script エディタを開き、本リポジトリのコードを貼り付け

fetchDailyStockPrices() をトリガーに設定（例：15分ごと）

トリガー設定後、次の区切り時間（例：23:00）まで待つと自動で動き出します！

        
### (注意)

初回実行時、Googleから「このアプリは確認されていません」という警告が表示されることがあります。その場合は以下の手順でスクリプトの実行を許可してください：

①「詳細」をクリック

➁「（プロジェクト名）に移動」を選択

③自分のGoogleアカウントを選択

④アクセス権限を確認し、「許可」をクリック　で実行し直せばOK

※これは、GASプロジェクトがGoogleにより公開確認されていないために表示される標準の警告です。

---

## 技術スタック & 工夫ポイント

このツールは、Google スプレッドシートとApps Scriptを組み合わせて、株価の取得・記録・可視化を自動化しています。以下は使用技術と設計上の工夫です：

### 🛠 使用技術

Google Apps Script（GAS） 　スプレッドシート操作・トリガー設定・グラフ生成などの自動化処理を実装

Google スプレッドシート 　株価データの蓄積・可視化・ユーザー操作のインターフェースとして活用

GOOGLEFINANCE 関数 　米国株のリアルタイム価格取得に使用（AAPL / META / GOOGL）

JavaScript（ES5ベース） 　GAS内でのロジック構築・条件分岐・エラー処理に活用

SpreadsheetApp.ChartBuilder API 　日別・週次の株価推移グラフを自動生成

---

### ✨ 設計上の工夫

市場時間の制御 　米国市場の開場時間（22:30〜5:00）に合わせて取得タイミングを最適化

視覚的な工夫 　±5%、±10%の変動に応じたセルの色分けで、株価の動きを直感的に把握可能

エラー耐性 　取得失敗時も処理が止まらず、グレー表示で視覚的に識別可能

グラフの見やすさ 　横長＆余白調整で、推移が一目でわかるように設計

データの重複防止 　同じ日付・時間帯のデータを上書きしないように工夫

再利用性の高いコード構造 　銘柄追加や期間変更も容易に対応可能

---    

## 📌 注意点

GOOGLEFINANCE 関数は一時的に取得失敗することがあります。再取得で回復する場合が多いです。

トリガー設定後、すぐには動かないことがあります。次の実行タイミングまでお待ちください。

---

## 📂 ファイル構成と役割

ファイル / シート名	役割
本日株価 シート	        当日の株価を時間ごとに記録するメインシート
株価グラフ シート	Apple / Meta / Google の株価推移を折れ線グラフで週間で表示
gsファイル(関数)	        株価取得・記録・グラフ生成などのロジックを記述
トリガー設定	        30分間隔の自動実行や日付切り替え処理を制御。22時台〜5時台の取得に対応

## 📄 .gs ファイルについての簡潔な書き方例

    複数の .gs ファイルに処理を分割しており、以下のような役割で構成されています：

        株価の取得・記録

        グラフの生成

        トリガーの設定と制御

        データの整形・色分け

    ※ファイル名は機能ごとに分けており、必要に応じて拡張・修正しやすい構造になっています。


---

## 🧩 今後の改善点

### 📈 グラフ機能の強化

2週間・1ヶ月のグラフ生成機能を追加する

1週間のグラフを、1日1回のトリガー実行のみで作成できるようにする

グラフ線が ±10%以上の変化で表示範囲から外れる問題に対応する

### 🗂 シート構成の整理

「本日株価」→「株価グラフ」の順にシート表示を並べ替える

### ⏱️ 取得タイミングの調整

0:00〜0:30の取得で前日分が上書きされる問題を解消する

取引時間（〜5:00）を過ぎて2回分カウントされる問題を修正する

市場開場前（22:00〜22:29）の取得を制御し、誤データの記録を防ぐ

### 🧑‍💻 ユーザー入力への対応

任意の米国株銘柄を入力すると、1日・１週間の株価推移グラフを自動生成する機能を追加する

---
